\chapter{Interface between the Computer and the Brain}
\label{chapter:one}
%\epigraph{Deus ex machina!}{Aeschylus}

\epigraph{...the brain is not a passive decoder of information but a dynamic and distributed modeler of a reality...}{Nicolelis}

%\quotation{ \textit{...the brain is not a passive decoder of information but a dynamic and distributed modeler of a reality comprised of a multitude of feedback, local, modulatory, and feedforward neural pathways conjuring a vast and elaborate organic spatiotemporal grid \cite{nicolelis2011beyond}} } 

\vspace{10px}

%De 15 a 30 referencias

%La idea es sacar info del libro de bci el manual ultimo y del paper de wolpaw de nature.

%La relación entre la senial ruido obtenida en el experimento de LIGO y la que se obtiene en EEG.

With Vidal's work in 1970s, Brain-Computer Interfaces started as a technological amusement, and it steadely moved toward a mature and highly researched area of work.  Outstanding success has been achieved with invasive BCI, i.e. with surgically implanted electrodes. Success stories has been made public like Braingate's implant on Jan Scheuermann, Cathy Hutchinson and Dennis Degray \cite{Pandarinath2017}.  Other works include the total reproduction of arm movement \cite{c27}, the restoration of reaching and grasping movements through a brain-controlled muscle stimulation device on a person with tetraplegia \cite{Ajiboye2017} and the remote control of a manipulator by a macaque using brainwave information \cite{c29} albeit of persistent biocompatibilities issues and the pervasive complexity and risks of surgical procedures. One noteworthy aspect of this novel communication channel is the ability to transmit information from the central nervous system to a computer device and from there use that information to control a wheelchair~\cite{Carlson2013}, as input to a speller application~\cite{Guger2009a}, in a Virtual Reality environment~\cite{Lotte2013} or as aiding tool in a rehabilitation procedure~\cite{Jure2016}.  Other novel applications include the real-time control of flight simulators \cite{Nourmohammadi2018} and the implementation of neuroadaptive interfaces where the computer detects the correctedness of a given command based on brainwave analysis \cite{Zander2016}.  Overall, the holly grail of BCI is to implement a new complete and alternative pathway to restore lost locomotion~\cite{WolpawJonathanR2012}.

\begin{chronology}[5]{1966}{2014}{90ex}[\textwidth]
\event{1966}{Kamiya, Neurofeedback for $\alpha$ waves}
\event{1969}{Fetz, Operand Conditioning}
\event{1973}{Vidal, first use of BCI word}
\event{1987}{Donchin \textbf{P300}}
\event{1989}{Hiraiwa, Bereitschaftspotentials}
\event{1991}{Wolpaw $\mu$ \textbf{Wadsworth BCI}}
\event{1993}{Pfurtscheller SMR \textbf{Graz BCI}}
\event{1995}{Jane Huggins invasive BrainGate}
\event{1997}{Anderson, Mental Tasks}
\event{1999}{Birmahuer SCP}
\event{2001}{Nicolelis, invasive BCI on primates}
\event{2003}{Middendorf, SSVEP}
\event{2006}{Millan, ErrP}
\event{2008}{Blankertz, adaptive \textbf{Berlin BCI}}
\event{2010}{Schalk, ECoG BCI}
\event{2012}{Zander, Passive BCI \textbf{pBCI}}
%\event{\decimaldate{25}{12}{2001}}{three}
\label{fig:story}
\end{chronology}

This graphic shows a brief chronology of the main events in BCI history, starting from the early works on Neurofeedback in the 70s and walking through the different paradigms.  In recent years, this discipline has gained mainstream public awareness with worldwide challenge competitions like Cybathlon~\cite{Riener2014,Novak2018} and even been broadcasted during the inauguration ceremony of the 2014 Soccer World Cup~\cite{WorldCup2014}.  New developments are approaching the out-of-the-lab high-bar and they are starting to be used in real world environments~\cite{Guger2017,Huggins2016}.  Moreover, BCI research had rampantly been advanced accomplishing a BCI Society, a BCI Journal, BCI Award, annual conference meetings, practical applications, myriads of startups companies and even included in the Gartner Hype Cycle \cite{GartnerHype2016}. 

From its root as assistive technology it has now expanded to include several application niches like temporal induced disability, neuroergonomy, early detection of human error, affective computing, biometric authentication, teleprescence (improvement of haptic interface), cyberinfrastructure and assistive robotics.  Intensive Care Units (ICU) and Disorders of Consciousness (DoC) \cite{Annen2018} (detection of remaining brain activity in comatose patients) are recent disciplines where BCI is showing tremendous prospects and possible applications.  

Their adoption as a clinical tool is still years ahead.  Stroke rehabilitation is the only area where clinical trials for BCI are being conducted. It is understood that the neurofeedback provided by a BCI interface improves the prognosis of motor rehabilitation~\cite{Ang2011}.

\vspace{10px}

\begin{story}[BCI Definition (circa 2018)]
\theoremstyle{definition}
\begin{definition}{}
\label{def:BCI}
\textit{A system that measures central nervous system activity and converts it into artificial output that replaces, restores, enhances, supplements, or improves natural CNS output and thereby changes the ongoing interactions between the CNS and its external and internal environment \cite{WolpawJonathanR2012}.}
\end{definition}
\end{story}

Hybrid BCI, or Brain Neural Computer Interface, are BCI devices that use not only signals from the CNS, they utilize any kind of available biosignal that can be volitionally modulated to transmit information (this is called dependant BCI).  When the pace of the BCI is regulated by external stimulus it is called synchronous and when the user choose their own pace to transmit information, it is often called asynchronous or self-paced BCI.

Recent years have seen an incredible advance of passive BCI, pBCI \cite{Zander2010}.  The original definition of BCI did not include passive modalities but per definition \ref{def:BCI} it is now part of this discipline.  The important aspect is that passive technologies do not entail necessary the volitional requirement to transmit information.  EEG-based passive BCI is a promising and advancing area of research and of commercial applications.

Despite all this, its primary objective, its core motive of moving into real applications for disabled people has yet to come \cite{Brunner2014,Jeunet2014,Allison2013}. They still lack the necessary robustness, and its performance is well behind any other method of human computer interaction, including any kind of detection of residual muscular movement~\cite{Clerc2016}. Among the many and current challenges of BCI \cite{Brunner2014} one which is still perennial is precisely their inability to be used and applied outside the BNCI community and specifically in clinical context.  

%BCIs are currently in a plateau.  BCNI Horizon, what the people is saying.  OpenBCI and the Wearables movement.
% The convergence of invasive BCI and noninvasive BCI into a huge community and the appearance of myriad of comapnies that are exploring the technology.
Quoting experts in the field,

\vspace{8px}

\textit{"We yet have an impractical and inaccessible exotica for very specific user groups" (Allison 2010)}

\vspace{10px}

\textit{"Effectiveness of non-invasive BCI systems remain limited…" (Wolpaw 2011)}

\vspace{10px}

\textit{"…to ponder if BCIs are really promising and helpful, or if they are simple a passing rod, reinforced by their sci-fi side..." (Lotte 2016)}

\vspace{10px}

The feasibility of the system has been proved but there are several challenges in BCI that need to be tackled. They can be summarizing as 
increasing the ITR, the pervasive low signal-to-noise ratio of brainwaves, particularly of noninvasive signals \cite{Lotte2018}, the reliability of the system, its portability, and the usability of the system \cite{Wang2018}, and at the same time decreasing the setup, the training and,calibration time and the subject's inter/intra variability. The search for practical, relevant, and invariant \textit{features} that convey good-enough information about the underlying cognitive process is still a goal to be achieved \cite{Perdikis2014}.  Ethical aspects of BCI \cite{Yuste2017} must also be considered and handled: cybersecurity threats and privacy concerns,  agency and identity issues that might be occurring by deleterious plasticity with BCI users and the strict peg to the \textit{Primun non nocere}~\footnote{\textit{First, do not harm}, in reference to the Hippocratic Oath} mandate.

\section{Brain Computer Interface Model and Architecture}

The draft architecture of a BCI system can be summarized in Figure~\ref{fig:bciblockdiagram}.  A volitional control, a will to transmit information, is exerted by a user. A brain signal acquisition device captures her/his signals using a measurement modality.  This module obtains the brainwaves and the information is digitalized and transmited to a computer device.  Signal preprocessing is applied to eliminate nuisances and artifacts and to enhance the Signal to Noise Ratio (SNR), or to apply spatial or frequency filters.  In the next step, a \textit{feature} is carefully constructed in order to differentiate at least between two different mental states.  Finally a classification step is applied to derive the actual information bit out of the system.   An application system uses this information to affect some external device.  By visual or any other sensory means, the feedback is fed back to the user and a loop is finally closed.

The central point of this system is called the \textit{Brain Machine Dilemma} \cite{WolpawJonathanR2012}.  The underlying idea is that the BCI system adapts to the user's thinking patterns but at the same time the brain is adapting to what the system is doing, and changing their own signals in the process.  This is the reason why it is often called, a \textit{co-adaptive system}, where two different intelligent devices, one biological and the other electronic, try to adapt to each other.

\begin{figure}[]
\centering
\includegraphics[scale=0.5]{images/bcichart.png}
\caption[BCI Block Diagram]{General components of a BCI system.}
\label{fig:bciblockdiagram}
\end{figure}

Let $X$ be a multichannel digital signal $X \in \mathbb{R}^{C \times N}$,  with $N$ being the length of the digitalized signal in sample points, and $C$ is the number of available channels.  This signal matrix is 

\begin{equation}
X = \left[
\begin{matrix} 
X(1,1)  & \cdots & X(n,1) & \cdots & X(N,1) \\
\vdots &             & \vdots &            & \vdots \\
X(1,c)  & \cdots & X(n,c) & \cdots & X(N,c) \\
\vdots &             & \vdots &            & \vdots \\
X(1,C)  & \cdots & X(n,C) & \cdots & X(N,C) \\
\end{matrix}
\right]   .
\end{equation}

The n-column $\mathbf{x}(n)$ of this matrix is a vector for a sample point $n$ in digital time for every available channel.  Additionally, $x(n,c)$  is a c-row with the multichannel signal as a scalar time-series for a particular channel $c$.  When the particular channel is not important, the notation $x(n)$ is using to emphasize a single-channel processing scheme.

The basic model of any BCI is to take this multichannel digital signal $\mathbf{x}(n)$, and transform it to an output control signal $y(n)$ which can be a scalar or binary function.  The BCI system can be modeled as the transformation $T$, which operates on the equation

\begin{equation}
y(n) = T\left[\mathbf{x}(n)\right].
\label{eq:bcimodel}
\end{equation}

What a BCI system must do, is to take at least a single bit of information out of $y(n)$ and use that information to derive some action. 

\section{Signal Processing}

From this signal processing point of view, BCIs are:

\begin{itemize}
\item Causal:  $ y(n) = T\left[  \mathbf{x}(m) \right] $, where $ m \leq n $.  The action of a BCI system depends on the history of the captured brainwaves.
\item Dynamic: $ y(n) = T\left[ \mathbf{x}(m),  \mathbf{\dot{x}}(m),\mathbf{\ddot{x}}(m), \cdots \right] $.  A BCI system is dynamic, where the output function do not depend only on the current value being observed, it does depend on its dynamic interactions.
\item Time invariant: $ y(n) = T\left[ \mathbf{x}(n) \right] \Rightarrow y(n-p) = T\left[ \mathbf{x}(n-p) \right] $.  The output of a BCI system does not depend on the particular time frame where it is being used.  However, adaptive BCI, which do adapt to the user behavior, are time variant.
\item Nonlinear: a system is linear when $T\left[ a_1 \mathbf{x}(n) + a_2 \mathbf{x}(n) \right]  = a_1 T \left[ \mathbf{x}(n) \right] + a_2 T \left[ \mathbf{x}(n) \right] $. Due to brainwave complexity, BCI systems are not linear.
\item Multirate or broadband \cite{Miller2010}:  The energy of brainwave spectrum is not confined to a certain band, and almost all frequency channels may convey some information.
\end{itemize}

There are several filters that can be applied to the system to eliminate artifacts, enhance the signal, and to ease the detection of the discriminative information.

\textbf{Static filters} like square or logartihmic, were traditionally used in analog signal processing and are currently already embedded in the measuring device.  Wiener and Kallman filters are usually applied to invasive techniques~\cite{He2013}.  The filter, particularly when it is linear, can be viewed as the matrix $M$ in:

\begin{equation}
y(n) = M T\left[\mathbf{x}(n)\right]
\label{eq:filters}
\end{equation}

\textbf{Spatial filters} are carefully adapted to the arrangement of sensors around or within the head and they emphasize the spatial structure of the information that is being captured. The head is divided in anatomical regions and electrode locations around the head are arranged according to neuroanatomical planes or axes (Figure~\ref{fig:neuroanatomy}).

\textbf{Spectral filters}, on the other hand, do consider brainwaves as a digital signals, and they perform different transformations based on the spectral information contained within the signal $\mathbf{x}(n)$.  They can be combined and aggregated creating  \textit{filter banks} to enhance signal quality. 


\begin{figure}[htb]
\centering
\subfigure[Neuronal Planes]{\includegraphics[scale=0.4]{images/neuralplanes.png}}
\subfigure[Neuroanatomical regions of the brain.]{\includegraphics[scale=0.4]{images/neuroanatomy.png}}
\caption[Neuroanatomical structures of the brain]{Neuronal Planes regularly used in neuroscience research.  In BCI they are used to understand electrode location and spatial filters.}
\label{fig:neuroanatomy}
\end{figure}

%\begin{figure}[]
%\centering
%\includegraphics[scale=0.5]{images/neuralplanes.png}
%\caption[Neural Planes]{Neuronal Planes regularly used in neuroscience research.  In BCI they are used to understand electrode location and spatial filters.}
%\label{fig:neuralplanes}
%\end{figure}
%
%\begin{figure}[]
%\centering
%\includegraphics[scale=0.5]{images/neuroanatomy.png}
%\caption[Neuroanatomy]{Neuroanatomical regions of the brain.}
%\label{fig:neuroanatomy}
%\end{figure}

\section{The Forward and Inverse Model}

Brainwaves are obtained via sensors. Each one of them captures only a part or a version of the information.  However, whatever is actually happening inside the brain is recovered indirectly from the \textit{sensor space}. From there, the information can be traced back to the real landscape where the information source is located, inside the \textit{source space}.  This is a regular problem found in engineering and it is not different in BCI.  \textit{Calculating} the signal on each a sensor from a projection of a known source of information from within the head is called \textit{The Forward Problem}\cite{Parra2008,WolpawJonathanR2012}  and doing the opposite, \textit{estimating} the contributions of different sources to whatever activity is found on sensors is called  \textit{The Inverse Problem}.  Although the latter is a complex ill-posed problem, it is more relevant in BCI because it allows to determine source origins that can be mapped more directly to cognitive activities. 

Particularly for noninvasive electrophysiological modalities, an additional problem makes things harder.  Due to its electromagnetic properties, the brain acts like conductive gel, and any signal that is generated inside the brain is irradiated to every direction and it can influence every sensor regardless of its position.  This is called \textit{Volume conduction} \cite{Nam2018,Buzsaki2012} and can be visualized in Figure~\ref{fig:volconduction}.

\begin{figure}[]
\centering
\includegraphics[height=6cm,width=14cm]{images/volconduction1.png}
\includegraphics[height=6cm,width=14cm]{images/volconduction2.png}
\caption[EEG Volume Conduction]{A source signal with positive/negative polarity is generated in a very specific region of the brain but due to volume conduction their influence affects a widespread area of the scalp where sensors are located (Image of the brain from Swartz Center for Computational Neuroscience).}
\label{fig:volconduction}
\end{figure}

\section{Brain Signals Measuring Techniques}

The measuring technique determines the most important taxonomic differentiation in BCI, according to the methodology that is applied to extract the information from the CNS.  All of them have been used so far for BCI applications.

\begin{enumerate}
\item EEG Electroencephalography: it is based on the electrical voltage detected by electrodes at the scalp.  It is explained in detail in Section~\ref{EEG}.
\item ECoG Electrocorticography: the electrodes are located bellow the skull and above the cortex, on the exposed region of the brain. Thus, a craniotomy is required.  It offers a very high temporal resolution, broader bandwidth and much better spatial resolution than EEG.  This modality has allowed very good performance in complex BCI schemes like speech synthesis from direct neural signals~\cite{Herff2016}.
\item MEG Magnetoencephalography: when active neurons generate electric currents, minuscule magnetic fields are generated.  It is considered complementary to EEG and ECoG, due to the fact that it is sensitive to neurons firing parallel to the scalp, which are hard to detect in EEG and ECoG.   Although MEG equipment is bulky and room-size, recent advances~\cite{Boto2018} are aiming to develop portable and wearable versions. 
\item PET Positron Emission Tomography: this radio nuclear measuring device, use a tracer molecule like fludeoxyglucose, which emits positrons.  Positrons interacts with biological tissue generating photons in exact opposite directions.  The tracer is spread around the body and the brain, and its concentration is higher in those areas where active neuron firing is being conducted which requires more glucose~\cite{Nam2010}. 
\item fMRI  functional Magnetic Resonance Imaging: this noninvasive, non-portable measuring technique, measures the so-called BOLD response: the Blood Oxygen Level-Dependent contrast.  This is based on the principle that firing neurons generates an imbalance of oxyhemoglobin and deoxyhemoglobin which can be detected on the magnetic resonator, with a very high spatial accuracy.
\item fNIRS  functional Near Infra Red Spectroscopy:  it also measures the concentration changes of oxy/deoxy-hemoglobin using light pulses of near-infrared wavelengths.  The different types of hemoglobin molecules absorb these light frequencies at different rates.  It is an indirect measure of brain activity.  Although it provides very good spatial localization, temporal localization is hindered by the hemodynamic response~\cite{Nam2010}.
\item INR Intracortical Neuron Recordings: Electrodes, tetrodes, or Multielectrode arrays MEAs (i.e. Utah Array)~\cite{Ajiboye2017} can be implanted inside the brain.  Often called iEEG, intracraneal EEG, it is designed to detect Local Field Potentials LFPs or even single-unit recording~\cite{Buzsaki2012}.
\end{enumerate}

ECoG and INR are invasive technologies that require a neurosurgery or craniotomy. The implantation of electrodes is performed inside the skull for the former, and inside the brain for the latter.   The remaining measuring techniques are external or noninvasive.  

\section{Electroencephalography}
\label{EEG}
Above all, electroencephalography, is the most widespread method to gather information from the CNS in a non-invasive way. It is of particular interest in BCI mainly because of its non-invasiveness, its optimal time resolution and acceptable spatial resolution. Moreover, it is portable, cheap, wearable and can be more easily integrated into fashionable designs aimed for real users, which prefer cap-like devices~\cite{Huggins2015}. 

The electroencephalography consists on the measurement of small variations of electrical voltage over the scalp. This represents the summed activity of post-synaptic potentials PSPs of pyramidal neurons located perpendicular to the scalp~\cite{Nam2018}. Only one percent of synchronized activity of pyramidal neurons are stronger that the remaining desynchronized neurons~\cite{Schomer2010} and explain ninety-nine percent of the signals obtained from EEG.  This technique is one of the most widespread used methods to capture brain signals and was initially developed by Hans Berger in 1924 and has been extensively used for decades to diagnose neural diseases and other medical conditions.  Figure~\ref{fig:sampleeeg} shows a sample EEG signal trace obtained with a digital and wearable EEG device.

%Routinely physicians explore morphologically these raw EEG signals scavenging for signs of disease or irregular patterns and they have been doing this since almost the dawn of the technology at the hands of Hans Berger. Sleep spindles, Lambda waves, K-Complexes, Vertex waves, Positive Occipital Sharp Transients and more visual features had been identified with relevant clinical characterizations [16]. Even within the BCI community, visually extracting artifacts for offline processing is a common and well known practice [1,11]. 

%The EEG signal goes from 10-100 microvolts
%monopolar, reference, averaged, 
%bipolar
%segmentation is commong, which is generally called epoching
%trials are general realizations of the experiment.
%tampering window could be gaussian, hamming, blackman, hanning
%Impedance

The first characterization that Dr. Berger detected was the Visual Cortical Alpha Wave, the \textit{Berger Rythm} \cite{Jansen1991}.  He understood that the amplitude and shape of this rhythm was coherently associated to a cognitive action (eyes closing).  
We should ask ourselves if the research advancement that came after that discovery would have happened if it weren't so evident that the shape alteration was due to a very simple and verifiable cognitive process.

The EEG signal is a highly complex multi-channel time-series.  It can be modeled as a linear stochastic process with great similarities to noise \cite{Thakor2004}.  It is measured in microvolts, and those slightly variations are contaminated with heavy endogenous artifacts and exogenous spurious signals.  
 
\begin{figure}[]
\centering
\includegraphics[height=7cm,width=14cm]{images/sampleeeg.eps}
\caption[Sample Multichannel EEG signal]{Sample EEG signal obtained from (g.Nautilus, g.Tec, Austria). Time axis is in seconds and five seconds are displayed.  The eight channels provided by this device are shown.}
\label{fig:sampleeeg}
\end{figure}


\begin{figure}[]
\centering
\includegraphics[height=8cm,width=8cm]{images/ElectrodePositions1020.png}
\caption[Electrode Locations]{International 10-20 system that standardize electrode locations over the scalp.}
\label{fig:electrodelocations}
\end{figure}

%locations.eps

The device that captures these small variations in current potentials over the scalp is called the electroencephalograph (Figure \ref{fig:digitalelectroencephalograph}).  Electrodes are located in predetermined positions over the head, usually embedded in saline solutions to facilitate the electrophysiological interface and are connected to a differential amplifier with a high gain which allowed the measurement of tiny signals. Although initially analog devices were developed and used, nowadays digital versions connected directly to a computer are pervasive.  A detailed explanation on the particularities and modeling of EEG can be obtained from \cite{Jackson2014}, and a description of its electrophysiological aspects from \cite{Haberman2012}.  Further details are covered in Chapter~\ref{chapter:three}. 

\begin{figure}[]
\centering
\includegraphics[height=4cm,width=7cm]{images/emotivsubject.jpg}
\includegraphics[height=4cm,width=7cm]{images/gTecsubject.jpg}
\caption[Wearable portable Digital Electroencephalograph]{Digital and wearable electroencephalographs.}
\label{fig:digitalelectroencephalograph}
\end{figure}

\section{EEG Signals}

Overall, EEG signals can be described by their phase, amplitude,  frequency and \textit{waveform}.  The following components regularly  characterize EEG signals:

\begin{itemize}
\item Artifacts:  These are signal sources which are not generated from the CNS, but can be detected from the EEG signal.  They are called endogeneous or physiological when they are generated from a biological source like face muscles, ocular movements, etc., and exogeneous or non-physiological when they have an external electromagnetic source like line induced currents or electromagnetic noise~\cite{Weeda2012}.  Ambulatory studies or out-of-the lab studies introduces artifacts that are derived from the person movement, from any kind of muscular electrical stimulator for rehabilitation treatments or from other devices in hybrid, or multi-modal BCIs.
\item Non-Stationarity: the statistical parameters that describe the EEG as a random process are not conserved through time, i.e. its mean and variance, and any other higher-order moments are not time-invariant~\cite{Jansen1991}.
\item DC drift and trending: in EEG jargon, which is derived from concepts of electrical amplifiers theory, Direct Current (DC) refers to very low frequency components of the EEG signal which varies around a common center, usually the zero value.  DC drift means that this center value drifts in time.  Although sometimes considered as a nuisance that needs to get rid of, it is known that very important cognitive phenomena like slow cortical potentials or slow activity transients in infants do affect the drift and can be used to understand some particular brain functioning~\cite{Vanhatalo2005,Schomer2010}.
\item Basal EEG activity: the EEG is the compound summation of myriads of electrical sources from the CNS.  These sources generate a baseline EEG which shows continuous activity with a small or null relation with any concurrent cognitive activity or task.
\item Intra-subject and Inter-subject variability: electroencephalographic signals vary greatly from person to person.  Additionally, EEG can be affected by the person's behavior like sleep hygiene, caffeine intake, smoking habit or alcohol intake previously to the signal measuring procedure~\cite{Farzan2017}.
\end{itemize}

Regarding how the EEG activity can be related to an external stimulus that is affecting the subject, it can be considered as

\begin{itemize}
\item Spontaneous: activity related to basal EEG, arising spontaneously, or self-regulated by the person.
\item Evoked: activity that can be detected synchronously after some specific amount of time from the onset of the stimulus.  This is usually referred as time-locked.  In contrast to the previous one, it is often called induced activity.
\end{itemize}

\noindent Additionally, according to the existence of a repeated rhythm, the EEG activity can be understood as

\begin{itemize}
\item Rhythmic: EEG activity consisting of waves of approximately constant frequency.  It is often abbreviated RA (regular rythmic activity). They are loosely classified by their frequencies, and their naming convention was derived from the original naming used by Hans Berger himself:

\begin{itemize}
\item Delta (0-4 Hz)
\item Theta (4-8 Hz)
\item Alpha Waves (10 Hz)
\item Sigma (12-16 Hz)
\item Beta (12-30 Hz)
\item Gamma (30-100 Hz)
\item Omega (60-120 Hz)
\item Rho (250 Hz) hippocampal
\item Sigma Thalamocortical burst (600 Hz)~\cite{Fedele2012}.
\end{itemize}

The last three are hardly encountered in conventional EEG~\cite{Vanhatalo2005}. 

\item Arrhythmic: EEG activity in which no stable rhythms are present.  
\item Dysrhythmic: Rhythms and/or patterns of EEG activity that characteristically appear in patient groups and rarely seen in healthy subjects.
\end{itemize}

The number of electrodes and their positions over the scalp determines a spatial structure: signal elements can be generalized, focal or lateralized, depending on in which channel (i.e. electrode) they are found.

%Finally, indexes can be derived as  CFC, Cross Frequency Coupling,  Phase-Amplitude Coupling, Phase-Phase Coupling.


\section{BCI EEG Paradigms}

%Due to their popularity ($71.2\%$ of the BCI projects submitted to BCI Award 2016 were with EEG) BCI based on EEG are 

\textit{BCI Paradigms} are referred to noninvasive EEG-based BCI configurations that are used to transmit volitional information.  The popularity of EEG in BCI Research influenced the adoption of conventional paradigms exclusively for noninvasive BCI.   Their chronology can be found at the beginning of the Chapter. They can be roughly~\cite{Chaudhary2016} described as:

\begin{enumerate}
\item Steady State Evoked Potentials: the basis for this paradigm is that when a subject attends certain stimulus, the dominant frequency component contained in the stimulus source can be found in the brain waves.  When stimulus sources are light, this is called SS Visual EP and the signals are prominent in occipital regions.  A similar process can be obtained with auditory stimulus, in which case they are called SS Auditory EPs.  Finally, this can be extended to somatosensory stimulation (i.e. tactile) and it is called SS Somatosensory EP.  By using different stimulus sources with different frequencies, the one that is \textbf{selectively attended} by a subject can be inferred based on the main frequency component found on the EEG trace~\cite{Nam2010}.
\item Bereitschaftspotentials, Readiness Potential or Movement-Related (Cortical) Potentials: these signals are slow and low frequency $\left[0.05, 3\right] \si{Hz}$ cortical potential that can appear when a subject is just about to engage in a movement related activity.  They are used in BCI as triggering markers, or to identify movement-related EEG potentials for neurorehabilitation~\cite{c52}.
\item Motor Imagery ERD/ERS: the motor imagery, i.e. the mental visualization of movement without actually performing it, triggers a neurophysiological response which is very similar to the one obtained when the movement is physically performed. Frequencies on the $\alpha$ range of EEG are desynchronized prior to movement imagery, and synchronized afterwards. At the same time, $\beta$ frequencies are resynchronized and increase in power after motor imagery. A subject can learn to think about moving a feet or moving a limb, and transfer a bit from this thinking patterns. This paradigm requires intensive training from subjects.  This is further explained in Chapter~\ref{chapter:five}.
\item P300: the positive deflection at 300 \si{\ms} is activated by a cognitive experiment called the oddball paradigm and can be used to detect which symbol a subject is paying attention on a flickering matrix.  By exploiting this information, a speller application can be implemented. This important signal is explained in details in Chapter~\ref{chapter:six}.
%\item N400: this pattern is related to speech processing.  A negative signal around 400 \si{\ms} appears every time a missmatch concept is found in a sequence of similar concepts.  Novel BCI systems can be implemented from this.
\item Mental Tasks: mentally rotating 3D objects, or calculating arithmetic operations are used to generate signals that can be detected and utilized to transfer a bit~\cite{Shin2018}.
\item Slow Cortical Potentials: these are very slow shifts in the electrical activity found in the cortex, of a very low frequency.  They can be modulated by \textbf{operand conditioning} protocols~\cite{WolpawJonathanR2012}.
\item Error Potentials: when a person recognizes that an error was committed during a task, a recognizable signal called ErrP can be detected along the EEG trace, time-locked to the onset when the error information is fed back to the person.  This very important potential is used in BCI applications to enhance the identification of false positives and to improve the overall interaction between the subject and the computer~\cite{Cruz2018}.
\item Visual Spatial Covert Attention: oscillatory activity in the $\alpha$ band of EEG can be modulated by changes in visual covert attention.  Visual covert attention is the ability to focus attention on objects on the peripheral vision.  Humans can voluntarily focus attention to locations in visual space without moving their eyes.  This voluntary control is reflected in changes on Visual Occipital Alpha Waves~\cite{c62}.  Alpha Waves are further detailed in Chapter~\ref{chapter:four}.
\end{enumerate}

These paradigms have been exploited in the most popular BCI configurations, the Wadsworth BCI, the Graz BCI, the Berlin BCI and the Tübingen BCI.  These platforms introduced pragmatic enhancements to use these paradigms to implement more practical devices~\cite{Nam2018,Schomer2010,Blankertz2008,Pfurtscheller2003,Neumann2003,Vaughan2006}.



\section{State of the Art of BCI Algorithms for EEG processing}

According to the general layout of a BCI system, Figure \ref{fig:bciblockdiagram}, specific algorithms or techniques are required for both the feature extraction and classification step.  The most relevant features used nowadays in BCI are:

\begin{itemize}
\item Time points:  the sequence of time series, often, concatenated in time or space.
\item Band Power: frequency based features.
\item Complexity:  based on complexity measurements like entropy, or fractal.
\item Statistical: Auto-regressive parameters or covariances matrix.
\end{itemize}

The most successfull used and verified classification methods for BCI \cite{Lotte2007} can be described as linear versions of machine learning tools.  Particularly, Support Vector Machines (SVM), Linear Discriminant Analysis (LDA) and its variant Stepwise Linear Discriminant Analysis (SWLDA).  SWLDA is relevant for two reasons:  the first is that the stepwise identification of features improves the selection criteria and also the spatial filter that this procedure encompass.  Additionally, from a pragmatic perspective, this method is included in the popular BCI2000~\cite{Schalk2004} package and is the default option for the identification of event related potentials.  Spatial filters have also being incorporated and have shown substantial improvements in classification accuracies: the canonical Common Spatial Patterns CSP for the identification of Motor Imagery as well as the xDAWN algorithm for P300 identification.

In recent years (circa 2018) classification accuracies in BCI have improved but the focus was not centered on any particular classification algorithm.  Instead, current contributions concentrate their efferts on how these algoritms are used~\cite{Lotte2018}.  Recent works can be described as:

\begin{itemize}
\item Ensemble classifiers: SVM ensembles~\cite{Rakotomamonjy2008} and variants of random forest~\cite{Steyrl2015}.  Features are segmented and divided and the forest performs a classification step on aggregated parts, maximizing classification accuracies.
\item Cross-paradigm BCI: the use of a reinforced signal with ErrP feedback or the use of SSVEP in combination with P300 detection~\cite{Lotte2018}.
\item Adaptive classifiers: the parameters of the classifiers are adapted continuously and online,  adapting to the natural variation of the EEG signals~\cite{Lotte2018}.
\item Transfer learning: transfer the calibration information obtained by users to new subjects.  This aims to ease the issue of the intra-subject variability in BCI, and to reduce the set-up and calibration times of a BCI system~\cite{Zanini2018}.
\item Rienmann geometry classifiers: the EEG stream is directly mapped onto a geometrical space equipped with a suitable Riemannian metric.  Hence, further data manipulation is carried out following principles of Riemannian geometry which yields very good results in terms of accuracies~\cite{Zanini2018}.
\item Tensor-based BCI:  the EEG data is viewed as a multidimensional matrix, a tensor.  The BCI operation is considered as an optimization problem that can be solved with sparsity and nonnegativity constraints~\cite{Vincent2010,Cichocki2008}.
\item Deep learning: deep learning is a very successful technique driven by the increased computational power of current computer devices.  Deep learning techniques have also being applied to BCI applications~\cite{Tjepkema-Cloostermans2018}.
\end{itemize}

%What if we can find an automatic system to identify, search, and even classify EEG signals based on the morphological visual structure of the signal, mimicking what the physician does, but using automated tools to do so?

\section{EEG Waveform Analysis}

This section describes the depictions that are used to describe EEG signals waveforms and the automatic procedures that were developed with this purpose.

\subsection{EEG Waveform Characterization}

The shape of the signal, the waveform, can be defined as the graphed line that represents the signal's amplitude plotted against time. It can also be called EEG biomarker,  EEG pattern, motifs, signal shape, signal form and a morphological signal \cite{Jansen1991}.

The signal context is crucial for waveform characterization, both in a spatial and in a temporal domain \cite{Jansen1991}.  Depending on the context, some specific waveform can be considered as noise while in other cases is precisely the element which has a cognitive functional implication.

%aforegoing
%hitherto

%phenomenological, the signal is treated as a black box.

%Signal Morphology is not precisely defined in the literature but may refer to
%
%\begin{itemize}
%\item RA (regular rythmic activity) 
%\item low-voltage rapid activity 
%\item sharp waves
%\item longitudinal-bipolar and transverse- bipolar montages (Clinical EEG)
%\end{itemize}

A waveform can have a characteristic shape, a rising or falling phase, a pronounced plateau or it may be composed of ripples and wiggles. In order to describe them, they are characterized by its amplitude, the arch, whether they have (non)sinusoidal shape, by the presence of an oscillation or imitating a sawtooth (e.g. Motor Cortical Beta Oscillations).  The characterization by their sharpness is also common, particularly in Epilepsy, and they can also be identified by their resemblance to spikes (e.g. Spike-wave discharge).

Other depictions may include, subjective definitions of sharper, arch comb or wicket shape, rectangular, containing a decay phase or voltage rise, peaks and troughs, short term voltage change around each extrema in the raw trace.  Derived ratios and indexes can be used as well, like peak and trough sharpness ratio, symmetry between rise and decay phase and slope ratio (steepness of the rise period to that of the adjacent decay period).  For instance,  wording like "Central trough is sharper and more negative that the adjacent troughs" are common in the literature.

Other regular characterizations which are based on shape features may include:

\begin{itemize}
\item Attenuation: Also called suppression or depression. Reduction of amplitude of EEG activity resulting from decreased voltage. When activity is attenuated by stimulation, it is said to have been "blocked" or to show "blocking".
\item Hypersynchrony: Seen as an increase in voltage and regularity of rhythmic activity, or within the alpha, beta, or theta range. The term suggest an increase in the number of neural elements contributing to the rhythm and a synchronization of neurons with similar firing patterns~\cite{Buzsaki2012}.
\item Paroxysmal: Activity that emerges from background with a rapid onset, reaching (usually) quite high voltage and ending with an abrupt return to lower voltage activity. 
\end{itemize}

\begin{itemize}
\item Monomorphic: Distinct EEG activity appearing to be composed of one dominant activity.
\item Polymorphic: Distinct EEG activity composed of multiple frequencies that combine to form a complex waveform.
\item Transient. An isolated wave or pattern that is distinctly different from background activity.
\end{itemize}


%\subsection{EEG Patterns}
%
%%The clinical EEG patterns are identified by the shape of waveform amplitude plotted against time.
%
%Non-exhaustive list of transient events
%Waveform characterization is of quite importance in terms of Event Related Potentials.  
%Determination of transient events, and particularly amplitude of different subcomponents, latency or even phase, has proved very importan concequences in terms of the different cognitive approach.
%
%%inverse problem is mathematically intractable Voytek 2009
%
%Oscillatory activity can also have their differente or distinctive waveforms.  Slow oscillations, which are assosiated with REM, sawtooth-shaped.
%Sleep spindles can also be considered oscilations and they have a distintinc form assosiated with stage 2 dream.
%Visual Cortical alpha and rolandic central mu waves arch-like structure (similar to the greek letter mu).  Slope Ratio.  Trough voltage remains contstant while peak voltage fluctuates.   Steep slopes,   Amplitude asymmetry 
%ponto-geniculo-occipital
%(PGO) waves.
%Rhythms in neural activity are observed across various temporal and spatial scales and are often
%referred to as oscillations (see Glossary) [1]. Traditionally, neural oscillations have been
%clustered into canonical frequency bands, including delta (1–4 Hz), theta (4–8 Hz), alpha (8–
%12 Hz), beta (15–30 Hz), gamma (30–90 Hz), and high gamma (>50 Hz). These bands roughly
%correspond to frequency ranges commonly observed in human electroencephalography (EEG)
%studies. Although they have been observed for nearly a century, recent theories suggest that
%these oscillations play an active role in neural communication.  Hippocampal theta oscillations, for example, are among the best-studied rhythms in the local field potential (LFP); they have a stereotyped sawtooth shape. In sleep research sleep 2 stage the background of KComplex and sleep spindles is theta waves
%
%%by application to Brain Computer Interfaces or EEG diagnosis (BCI a review, BCI Vidal 1973)
%
%
%
%%(e.g. FIRDA - Frontal Intermittent Rhythmic Delta) and posteriorly in children e.g. OIRDA - Occipital Intermittent Rhythmic Delta).
%
%%alpha dissapears when alerting by any mechanism (thinking, calculating)
%
%a) Spike: a transient with a pointed peak and a duration from 20 to under 70 msec.
%b) Sharp wave: a transient with a pointed peak and duration of 70-200 msec.
%
%Some initial works on EEG explored the idea to extend human capacities analyzing EEG waveforms  (automatic detection of k complexes), (A Waveform Analyzer Applied to the Human EEG) where a feature from amplitude and frequency of its signal and its derivative in time-domain is used.  Althought CASENET REFERENCe explored "waveform" structure they were purely based on spike detection based on feeding artificial neural networks.  
%
%ACA VA EL RESTO DE LOS METODOS (fujimori, PAA, etc).  Uchida 1999

The conventional clinical procedure consists in analyzing the paper strip that is generated by the plot of the signal obtained from the device.  Expert technician and physicians analyze visually the plots looking for specific patterns that may give a hint of the underlying cognitive process or pathology.   Atlases and guidelines were created in order to help in the recognition of these complex patterns.   Even video-electroencephalography scalp recordings are routinely used as a diagnostic tools \cite{Giagante2003} .  The clinical EEG research has also focused on temporal waveforms, and a whole branch of electrophenomenology has arisen around EEG \textit{graphoelements} \cite{Schomer2010}.  

Sleep research has been studied in this way by performing Polysomnographic recordings (PSG)  \cite{Rodenbeck2006}, where the different sleep stages are evaluated by visually marking waveforms or graphoelements in long-running electroencephalographic recordings, looking for patterns based on standardized guidelines.   Visual characterization includes the identification or classification of certain waveform components, or transient events, based on a subjective characterization (e.g. positive or negative peak polarity) or the location within the strip.  It is regular to establish an amplitude difference between different waveforms from which a relation between them is established and a structured index are created (e.g. sleep K-Complex is well characterized based on rates between positive vs. negative amplitude) \cite{Uchida1999}.  Other relevant EEG patterns for sleep stage scoring are alpha, theta, and delta waves,  sleep spindles, polysplindles, Vertex Sharp Waves (VSW), and sawtooth waves (REM Sleep).

Moreover, EEG data acquisition is a key procedure during the assessment of patients with focal epilepsy for potential seizure surgery, where the source of the seizure activity must be reliably identified. The onset of the epileptic seizure is defined as the first electrical change seen in the EEG rhythm which can be visually identified from the context and it is verified against any clinical sign indicating seizure onset.  The Interictal Epileptiform Discharges (IEDs) are visually identified from the paper strip, and they are also named according to their shape: spike, spike and wave or sharp-wave discharges\cite{EEGIntro}.  

%Seizures captured in their entirety typically show progression from low-voltage, high-frequency spikes to high-voltage, low-fre- quency spike-and-slow wave activity, before stopping abruptly and being replaced by background slowing or suppression (Fig. 29.9). Usual morphologic features include typical rhythmic, gen- eralized, symmetric spike-and-waves or polyspikes and waves at 2 to 3.5 Hz; atypical spike and wave with lower frequency and less symmetry; multiple spike-and-wave (repetitive complexes of two or more spikes followed by a slow wave); and high-voltage, repetitive, rhythmic, focal or generalized delta activity with inter- mixed spikes, sharp waves, or sharp components (Fig. 29.24) (45). Diagnosis is more difficult when the seizure (or SE) pre- cedes the beginning of the tracing and continues beyond its end. In such cases, rhythmic sharp features, typically faster than 1 Hz, may be seen, often with variability.

%Finally, there are specific EEG patterns that can be used to determine Depth of anestisia. 

%The waveform of the EEG depends on the settings of the capturing device.  The most important part to consider is that of montage.  It could be bipolar or referencial.  The traditional convention, somehow maintained in neuro research, downward polarity was considered negative and upward deflection for negative (Knott, 1985)  It is of utmost importance to remark that  EEG waveforms represent the differential voltage between a given electrode and the recording reference. It is therefore clear that the choice of reference completely determines EEG waveforms (Lehmann, 1987; Dien, 1998), an important methodological consideration that all too often is still not recognized in the EEG literature. For example, recording with a vertex (Cz) reference would lead to small EEG deflections in the proximity of Cz due to potential synchronization of firing activities within closely spaced brain regions and volume propagation of the EEG signal. Similarly, recording with mastoid or linked ears montage would lead to rather small waveforms at electrodes positioned over temporal brain regions (Pivik et al., 1993). Digital EEG can be rereferenced offline.  

%
%BCI --> distinguishing the pertinent signal characteristics from extraneous content and representing them in a compact or menaingful form, amenable to interpretation by a human or computer (Wolpaw and Wolpaw)

%Transient phenomena allows also to record occurrence and temporal sequence (mimicking spike analysis in neuro reserach)

%The traditional approach do not consider waveform even though the brain oscilations are in general nonsinusoidal (reference)
% Waveform characterization, on the other hand, has been extensively used in artifact detection and averaging.

\subsection{EEG Waveform Analysis Algorithms}
\label{waveformalgorithms}

Shape or waveform analysis methods are considered as nonparametric methods.  They explore signal's time-domain metrics or even derive more complex indexes or features from it~\cite{Thakor2009}. 

One of the earliest approach to automatically process EEG data is the Peak Picking method.  Although of limited usability, this procedure has been used to determine latency of transient events in EEG~\cite{Jaskowski2000,Zhang2011}.  Straightforward in its implementation, it consists in selecting a simple component based on the expected location of its more prominent deflection~\cite{Ouyang2017}.  Evoked Potentials (EPs) and Event Related Potentials (ERPs) are transient component that may arise as a brain response to an external visual, tactile or auditory stimulus.  The P300 signal that is used for some BCI Spellers is the prototypical Event Related Potential.  Particularly, EPs are regularly used to assess auditory response in infants. ERPs are characterized by their most prominent peaks, where the name of many of the EEG features evoke directly a peak within the component, e.g. P300 or P3a, P3b or N100.  This leads to a natural procedure to classify them visually by selecting appropriate peaks and matching their positions and amplitudes in an orderly manner.  The letter provides the polarity (Positive or Negative) and the numbering shows the time referencing the stimulus onset, or the ordinal position of each peak (first, second, etc).   Finally, the trailing letter is added to describe different variants of components that initially were considered the same.

A related method is used in \cite{Alvarado-Gonzalez2016} where the area under the curve of the EEG is sumarized to derive a feature.  This was used in the seminal work of Farwell and Donchin on P300 \cite{Farwell1988,WolpawJonathanR2012}. Additionally, a logarithmic graph of the peak-to-peak amplitude which is called amplitude integrated EEG (aEEG) \cite{Shah2015} is utilized nowadays in Neonatal Intensive Care Units.

Other works explored the idea to extend human capacities analyzing EEG waveforms \cite{Klein1976} where a feature from the amplitude and frequency of its signal and its derivative in time-domain is used.  Moreover, alternative schemes explored the use of Mathematical Morphology, where the time-domain structure of contractions and dilations are studied~\cite{Yamaguchi2009}. The Merging of Increasing and Decreasing Sequences (MIDS)~\cite{Zhang2013} provides a filter or heterogeneous downsampling scheme which is based on the waveform structure, similar to what is provided in Local Binary Patterns  (1-D LNBP, 1D-LBP and LBP) algorithms~\cite{Jaiswal2017} .  Finally the proposals of Burch, Fujimori, Uchida and the Period Amplitude Analysis (PAA) algorithm are few of the earliest proposals where the idea of capturing the shape of the signal were established~\cite{Uchida1996}.  Three algorithms are explained in detail in the following section.

%Althought CASENET REFERENCe explored "waveform" structure they were purely based on spike detection based on feeding artificial neural networks.  

 %(fujimori, PAA, etc).  Uchida 1999

%\subsubsection{Averaging Methods}
%
%The methods that allow to identified waveforms are used to determine different alignments while averaging epochs.
%
%This long-standing problem has been tackled from different perspectives.  Woody's Template Matching is perhaps the best effort as well as Pham, and Tuan and others EML.
%
%Dictionary, template based method.  Many do not consider the waveform, albeit they do use a set of templates obtained from a dictionary.
%
%Cross Covariance with Template or Cross Correlation or ACF: Autocorrelation Function: PHAM METHOD
%
%Applying a FIR filter with templates 
%
%Krusienski et al 2007
%Serby et al 2005
%
%extended to wavelent analysis.
%
%Dynamic Time Warping and other Warp Averaging methods were also used.
%
%Wrapping Analysis
%
%Warp averaging

%Where are the waveforms ? By estimates from the 2016 BCI Award, around 71.2$\%$ of noninvasive BCI research is based on Electroencephalography (EEG) [1]. Although mature clinical EEG has traditionally focused on temporal waveforms, and a whole branch of electrophenomenology has arisen around EEG graphoelements [2], signal analysis methods which follow this path has been overshadow in BCI research. Few works have investigated the idea of exploiting signal waveforms to analyze the EEG signal on BCI applications. The seminal work of Bandt-Pompe Permutation Entropy [3] explores succinctly this concept and in [4] an approach based on Slope Horizontal Chain Code is presented. A similar methodology is implemented in [5] based on Mathematical Morphological Analysis. The work proposed here is based on waveform analysis of the shape of the EEG signal, but using the histogram of gradient orientations, mimicking what traditionally electroencephalographers have been doing for almost a century: visually inspecting raw EEG signal plots. Material, Methods and Results: The histogram of gradient orientations is a popular and powerful tool used in Computer Vision to characterize local features from images and is the basis of the feature generation algorithm in Lowe's SIFT Descriptor [7]. This technique can be applied to identify components in EEG signals in five steps, (1) signal preprocessing, (2) signal segmentation, (3) transformation on a channel by channel basis of each signal segment into a binary image of a signal plot, (4) assignment of keypoint location on the newly created image depending on the physiological phenomena under study and finally (5) calculation of the histogram of gradient orientations using finite differences from the image around the keypoint (Figure 1). This method generates a feature, a normalized 128-dimension SIFT descriptor, which can be used to compare the signal segments that were used to generate the plots, thus they can be used to analyze the underlying cognitive phenomena. This method was used to identify and detect Visual Occipital Alpha Waves, Motor Imagery Rolandinc Mu rhythms [6] with results above chance level. It was also tested on P300 detection for Visual P300 Speller Matrix on ALS public dataset and for an own dataset of healthy subjects as well as identifying K-Complexes in sleep EEG (unpublished, under review). Discussion: A procedure which is biomimetically based on how the visual cortex works by detecting orientations, ironically, is used precisely to detect information from the brain. Although we found that it is possible to decode with accuracy above chance level and to differentiate patterns with cognitive correlations, the stability of the signature of the component is a key and challenging aspect. The method was also applied to patterns which are more frequently studied by their spectral characteristics. Significance: A method to analyze EEG signals which is based on the waveform characterization is presented. The benefits of the proposed approach are twofold, (1) it has a universal applicability because the same basic methodology can be applied to detect different patterns in EEG signals with applications to BCI and (2) it has the potential to foster close collaboration with physicians and electroencephalograph technicians because the approach follows the established procedure of the clinical EEG community of analyzing waveforms by their shapes.


%La idea es estructurar el paso a paso de como se puede ir usando el descriptor de gradientes de sift para 
%mapear informacion.  Primero con una señal cruda, luego agregarle informacion extra, luego agregar ruido al azar, y finalmente empezar con información real de señales.  El tema luego se focaliza en EEG especificamente para BCI.


%Describir la importancia de la impedencia (basado en el libro de Signal processing for neuro) con el paper que habla sobre EEG mas la pagina 144 del libro 2 de lotte.
%
%Aca tambien pueden ir las referencias a la tesis de spinelli
%
%Pattern Matching


%Esta es la razon porque el metodo funciona ya que lo que termina detectando es de manera masiva
%esas formas especificas que son las que le dan a las ondas alfa y mu sus nombres.
%
%In human electrophysiology, oscillations with stereotyped nonsinusoidal shapes include the
%sensorimotor mu rhythm, motor cortical beta oscillation, and cortical slow oscillations. The mu
%rhythm oscillates at an alpha frequency (around 10 Hz) and was named because its waveform
%shape resembles the Greek character m (Figure 1A). It is characterized by the fact that one
%extremum (e.g., its peak) is consistently sharper than the other (e.g., its trough); it is also
%described as an arch, comb, or wicket shape [4–10].
%In addition to the sensorimotor mu rhythm, we have recently highlighted that motor cortical beta
%oscillations also have striking nonsinusoidal features [11]. These beta oscillations manifest a
%sawtooth shape in that their voltage either rapidly rises before more slowly falling off, or vice
%versa (Figure 1B).


%\item Merging of Increasing and Decreasing Sequences
%\item Local Binary Patterns (1-D LNBP, 1D-LBP and LBP)

%\textit{Pursuit} algorithms refer, in their many variants, as blind source separation \cite{Vincent2010} techniques that assume the EEG signal as a linear combination of different sparse sources extracted from a template's dictionary.  Matching Pursuit \textit{MP}~\cite{Mallat1993}, the most representative of this algorithms, is a greedy variant that decomposes a signal into a linear combination of waveforms, called atoms, that are well localized in time and frequency \cite{ChandranKS2016}.  This method has been used to identify epileptogenetic patterns from EEG traces~\cite{Vareka2012}.
%
%Another method that explores the waveform is Bond and Pompe Permutation Entropy~\cite{Bandt2002}.  This has been extensively used in EEG processing, with applications on Anesthesia, Sleep Stage evaluation and increasingly for Epilepsy pre-ictal detection .  This method generates a code based on the orderly arrangement of sequential samples, and then derives a metric which is based on the number of times each sequence is found on the signal.  This numeric value can be calculated as information entropy~\cite{Nicolaou2010}.
%
%A related method is Slope Horizontal Chain Code and Slope Chain Code (SCC)~\cite{Alvarado-Gonzalez2016}. This algorithm proceeds by generating a coding scheme from a sequence of sample points. This encoding is based on the angle between the horizontal line on a 2D-plane and any segment produced by two consecutive sample points, regarding them as coordinates on that plane.  

%EEG signals are remarkably complex and have been characterized as a multichannel non-stationary stochastic process.  Additionally, they have high variability between different subjects and even between different moments for the same subject, requiring adaptive and co-adaptive calibration and learning procedures~\cite{Clerc}.  Hence, this imposes an outstanding challenge that is necessary to overcome in order to extract information from raw EEG signals.
%
%Moreover, EEG markers~\cite{Clerc} that can be used to  transmit volitional information are limited, and each one of them has a particular combination of appropriate methods to decode them. Inevitably, it is necessary to implement  distinct and specialized algorithmic methods, to filter the signal, enhance its Signal to Noise Ratio (SNR), and try to determine some meaning out of it.  

\subsection{Waveform-based Feature Extraction Algorithms}

The method presented in this Thesis generates a feature that can be classified.  Likewise, the following methods provide a feature that can be used as a template, whereas all of them are based on metrics extracted from the shape of the signal.  The signal $x(n)$ a single-channel EEG time series EEG out of $x(n,c)$ for a given fixed channel $c$.  The notation $f=\{f_i\}_{1}^{n} $ or $f=\{f_i\}_{i \in J}^{} $  will be used to describe the concatenation of scalar values to form a multidimensional feature vector $f=\{f_1,f_2,...,f_n\}$. These features can be used to create dictionaries or template databases.  These templates provide the basis for the pattern matching algorithm and offline classification. 

\subsubsection{Matching Pursuit - MP 1 and MP 2}

\textit{Pursuit} algorithms refer, in their many variants, as blind source separation \cite{Vincent2010} techniques that assume the EEG signal as a linear combination of different sparse sources extracted from a template's dictionaries.  Matching Pursuit \textit{MP}~\cite{Mallat1993}, the most representative of these algorithms, is a greedy variant that decomposes a signal into a linear combination of waveforms, called atoms, that are well localized in time and frequency \cite{ChandranKS2016}.  Given a signal, this optimization technique, tries to find the indexes of $m$ atoms and their weights (contributions) that minimize,


\begin{equation}
\varepsilon =  \left\lVert   x(n) - \sum_{i=1}^{m} w_i g_{i}(n)   \right\rVert
\label{eq:mperror}
\end{equation}

\noindent which is the error between the signal and its approximation constructed by the weighted $w_i$ atoms $g_{i}$, and calculating the euclidean norm ${\left\lVert \cdot \right\rVert}_{2}$.  The algorithm goes by first setting the approximating signal $\tilde{x}_{0}$  as the original signal itself,  

\begin{equation}
\tilde{x}_{0}(n) = x(n)
\label{eq:mp2}
\end{equation}

\noindent and setting the iterative counter $s$ as $1$. Hence, it searches recurrently the best template out of the dictionary  that matches current approximation.  

\begin{equation}
g_{s} = \arg \max_{g_{i}} \left\lvert  \sum_{n=1}^{N} \tilde{x}_{s-1}(n) \; g_{i}(n) \right\rvert 
\label{eq:mp3}
\end{equation}

\noindent where $g_{i}$ are all the available scaled, translated and modulated atoms from the dictionary.  The operation $\left\lvert \cdot \right\rvert$ corresponds to the absolute value of the inner product.  This step determines the atom selection process, and their contribution is calculated based on 

%The operation $\left\lvert < \cdot,\cdot > \right\rvert$ corresponds to the absolute value of the inner product. 


\begin{equation}
w_{s} =  \frac{\sum_{n=1}^{N} \tilde{x}_{s-1}(n) \; g_{s}(n)}{  {\left\lVert  g_{s} \right\rVert}^{2} }
\label{eq:mp4}
\end{equation}

\noindent with $s$ representing the index of the selected atom $g_{s}$ and $\left\lVert \cdot \right\rVert$ its euclidean norm.  Finally the contribution of each atom is subtracted from the next approximation~\cite{Cohen2014,Sanei2007, Mallat1993}

\begin{equation}
\tilde{x}_{s}(n)=  \tilde{x}_{s-1}(n) - w_{s} g_{s} (n)
\label{eq:mp5}
\end{equation}

The stopping criteria can be established based on a limiting threshold on Equation \ref{eq:mperror} or based on a predetermined number of steps and selected atoms.  Two variants of this algorithm are evaluated. In \textit{MP 1} the dictionary is constructed with the normalized templates directly extracted from the real signal segments which is a straightforward implementation of the pattern matching technique.  In \textit{MP 2} the coefficients of Daubechies least-asymetric wavelet with 2 vanishing moments atoms are used to construct the dictionary~\cite{Vareka2012}.  For the first version, the matching against the template is evaluated according to Equation \ref{eq:mperror} directly, whereas for the latter each feature is crafted by decomposing the signal in its coefficients and building, an eventually sparse, vector with them:

\begin{equation}
f =  {\bigg \{ w_{i} \bigg \}}_{1}^{m} 
\label{eq:mp6}
\end{equation}

\noindent where $D$ is the size of the dictionary.  

%On the other hand, Morphological Component Analysis is a variant form of Blind Source Separation which can be considered the extension of Matching Pursuit algorithm. (cita a esa parte del paper).


\subsubsection{Permutation Entropy - PE}

Bond and Pompe Permutation Entropy has been extensively used in EEG processing, with applications on anesthesia, sleep Stage evaluation and increasingly for Epilepsy pre-ictal detection \cite{Bandt2002}.  This method generates a code based on the orderly arrangement of sequential samples, and then derives a metric which is based on the number of times each sequence is found along the signal.  This numeric value can be calculated as information entropy~\cite{Nicolaou2010}. Let's consider a signal on a window of length $W$ represented by the sample points

\begin{equation}
(x_1,x_2,...,x_{W})
\label{eq:pesignal}
\end{equation}

\noindent and resampled by $\tau$ intervals, starting from the sampling point $n$, doing

\begin{equation}
(x_n,x_{n+\tau},x_{n+2 \tau}...,x_{n+(m-1)\tau}).
\label{eq:pe2}
\end{equation}

This sequence is of order $m$, which is the number of sample points used to derive the ordinal element called $\pi$. There are $m!$ ways in which this sequence can be orderly arranged, according to the position that each sample point holds within the sequence in a strict order relationship.  For example if $m=3$, and the first sample point is the bigger, the second is the smaller and the third one is in the middle, the ordinal element $\pi$ corresponds to $(3,1,2)$. Thus, along the signal window there can be at most $k$ different ordinal (and overlapping) elements $\pi_{s}$

\begin{equation}
(\pi_{1},\pi_{2},...,\pi_{k})
\label{eq:pe3}
\end{equation}

\noindent with $k = W-(m-1) \tau$.  The probability density function \textit{pdf} for all the available permutations of order $m$ should be $ \textbf{p} = (p_1,p_2,...,p_{m!}) $ with $ \sum_{i=1}^{m!} p_{i} = 1 $.

Hence, the time series window is mapped to a new set of $k$ ordinal elements, and the \textit{pdf} can be calculated by the empirical permutation entropy,

\begin{equation}
p_i = \frac{1}{k} \sum_{s=1}^{k} \left[ \pi_{s} = \pi_{i} \right]
\label{eq:pe4}
\end{equation}

\noindent with $1 \leq i \leq m!$. The Iverson Bracket $ \left[ \cdot \right] $ resolves to $1$ when their logical proposition argument is true, $0$ otherwise. Therefore, for each $i$ only those ordinal elements $\pi_{s}$ that were effectively found along the signal are counted to estimate $p_i$, and zero elsewhere.  The empirical permutation entropy can be calculated from the histogram as,

\begin{equation}
H(\textbf{p}) = \sum_{i=1}^{m!} p_{i} \; log \frac{1}{p_{i}}.
\label{eq:pe5}
\end{equation}

The implemented code was derived from~\cite{Unakafova2013}, and the model description from \cite{Berger2017}.  This procedure produces a scalar number for the given signal window of size $W$.  To derive a feature, a sliding window procedure must be implemented to cover an entire segment of length $N$.  Thus, the length of the feature is $N - (W + \tau (m - 1))$.

\begin{equation}
f =  {\bigg \{ H(\textbf{p})_{u} \bigg \}}_{W + \tau  m}^{N}.
\label{eq:pe6}
\end{equation}

\noindent with $u$ varying on a sample by sample basis along the signal, starting from the specified index.

\subsubsection{Slope Horizontal Chain Code - SHCC}

This algorithm~\cite{Alvarado-Gonzalez2016} proceeds by generating a coding scheme from a sequence of sample points. This encoding is based on the angle between the horizontal line on a 2D-plane and any segment produced by two consecutive sample points, regarding them as coordinates on that plane.  

A signal of length $N$, can be represented by a list of ordered-pairs $e$,

\begin{equation}
e = \left[ (x,y)_{1}, (x,y)_{2}, ..., (x,y)_{N} \right]
\label{eq:shccdelta}
\end{equation}

\noindent and it can be divided into $G$ different blocks.  These blocks are obtained by resampling the original signal from the index 

\begin{equation}
G = \lfloor n + ( m \Delta ) + 0.5 \rfloor
\label{eq:shcc2}
\end{equation}

\noindent with $n$ being the original sampling index on $ 1 \leq n \leq N $ and $\lfloor \cdot \rfloor$ being the floor operation, i.e. rounding of the number argument to the closest smaller integer number.  On the other hand, $\Delta$ can be obtained by

\begin{equation}
\Delta = \bigg \lceil \frac{N}{G+1} \bigg \rceil
\label{eq:shcc3}
\end{equation}

\noindent with $ G < N $ and using instead $\lceil \cdot \rceil$ as the ceil operation, the rounding to the closest bigger integer number. Lastly, the value $m$ can be derived from

\begin{equation}
m = sign \bigg (  \frac{N-1}{\Delta} \bigg )  \bigg \lfloor \left\lvert \frac{N-1}{\Delta} \right\lvert \bigg \rfloor.
\label{eq:shcc4}
\end{equation}

This resampling produces a new sequence of values,

\begin{equation}
e' = \left[ (x',y')_{1}, ...,(x',y')_{s}, ..., (x',y')_{G} \right].
\label{eq:shcc5}
\end{equation}

The next step is the normalization of each ordered-pair as vectors $\textbf{x'} = (x'_{1},...,x'_{G})$ and $\textbf{y'} = (y'_{1},...,y'_{G})$ according to

\begin{equation}
\hat{\textbf{x}} = \frac{\textbf{x'} - \min(\textbf{x'}) \textbf{1} }{\max(\textbf{x'}) - \min(\textbf{x'})} 
\label{eq:shcc6}
\end{equation}

\begin{equation}
\hat{\textbf{y}} = \frac{ \textbf{y'} - \min(\textbf{y'}) \textbf{1}}{\max(\textbf{y'}) - \min(\textbf{y'})} 
\label{eq:shcc7}
\end{equation}

\noindent with $\textbf{1}$ being the vector of length $G$ with all their components equal to $1$.  Hence, the scalar components $\hat{x}_{s}$ of $\hat{\textbf{x}}$, and $\hat{y}_{s}$ of $\hat{\textbf{y}}$, with $s$ varying between $1$ and $G$ are effectively normalized to $\hat{x}_{s},\hat{y}_{s} \in [0,1]$. \\

Finally, the feature is constructed by calculating the point-to-point slope against the horizontal plane,

\begin{equation}
f = \bigg \{  \frac{\hat{y}_{s}-\hat{y}_{s-1}}{\hat{x}_{s}-\hat{x}_{s-1}}  \bigg \}_{2}^{G} 
\label{eq:shcc8}
\end{equation}


